{% extends "base.html" %}

{% block content %}

<script type="text/javascript">
  document.getElementById("nav-"
  + {% if user.username == runner.username %}"username"
  {% else %}"runners"{% endif %}
  ).setAttribute("class", "active");
</script>

<div class="row">
  <div class="col-lg-3 col-md-3 col-lg-push-9 col-md-push-9">
    {% if gravatar %}
    <img src="{{gravatar}}" alt="Gravatar" class="img-responsive">
    {% endif %}
  </div>
  <div class="col-lg-9 col-md-9 col-lg-pull-3 col-md-pull-3">
    <h1>{{runner.username}}</h1>
    {% if runner.twitter %}
    <a href="https://twitter.com/{{runner.twitter}}" 
       class="social-button pull-left">
      <img src="/static/icons/twitter.png" alt="Twitter" 
	   class="img-responsive img-social">
    </a>
    {% endif %}
    {% if runner.youtube %}
    <a href="https://youtube.com/{{runner.youtube}}" 
       class="social-button pull-left" style="margin-right: 3px;">
      <img src="/static/icons/youtube.png" alt="Youtube" 
	   class="img-responsive img-social">
    </a>
    {% endif %}
    {% if runner.twitch %}
    <a href="https://twitch.com/{{runner.twitch}}" 
       class="social-button pull-left" style="margin-top: 2px;">
      <img src="/static/icons/twitch.png" alt="Twitch" 
	   class="img-responsive img-social" style="height: 33px;">
    </a>
    {% endif %}
  </div>
</div>

<a href="/runner/{{username_code}}?q=view-all">
  {% if user.username == runner.username %}
  View / edit runs
  {% else %}
  View all runs
  {% endif %}
</a>
<table class="table">
  <thead>
    <tr>
      <th class="hidden-xs"></th>
      <th>Game</th>
      <th>Category</th>
      <th>Personal Best</th>
      <th>Runs</th>
      <th>Average Time</th>
      <th>Best Known Time</th>
    </tr>
  </thead>
  <tbody>
    {% for pb in pblist %}
    <tr>
      <td rowspan="{{pb['infolist']|length}}" class="hidden-xs">
	<center>
	  <a href="/game/{{pb['game_code']}}">
	    <img id="img-{{pb['game_code']}}" alt="" class="img-responsive" 
		 style="max-height: 50px;" src="/static/boxart/__blank__.png">
	  </a>
	</center>
      </td>
      <td rowspan="{{pb['infolist']|length}}">
	<a href="/game/{{pb['game_code']}}">
	  {{pb['game']}}
	</a>
      </td>
      {% for info in pb['infolist'] %}
      {% if not loop.first %}
    <tr>
      {% endif %}
      <td>{{info['category']}}</td>
      <td>
	{% if info['video'] %}<a href="{{info['video']}}">{% endif %}
	  {{info['pb_time']}}{% if info['video'] %}</a>{% endif %}
      </td>
      <td>{{info['num_runs']}}</td>
      <td>{{info['avg_time']}}</td>
      <td>{% if info['bk_time'] %}
	{% if info['bk_video'] %}<a href="{{info['bk_video']}}">{% endif %}
	  {{info['bk_time']}} by {{info['bk_runner']}} 
	  {% if info['bk_video'] %}</a>{% endif %} 
	{% if user.username == runner.username %}
	(<a href="/game/{{pb['game_code']}}/update-bkt?c={{info['category_code']}}">update</a>)
	{% endif %}
	{% else %}
	{% if user.username == runner.username %}
	(<a href="/game/{{pb['game_code']}}/update-bkt?c={{info['category_code']}}">set</a>)
	{% else %}
	-
	{% endif %}
	{% endif %}
      </td>
    </tr>
    {% endfor %}
    {% endfor %}
  </tbody>
</table>

<!-- Add game images when they exist -->
<script src="/static/js/util.js"></script>
<script type="text/javascript">
  {% for pb in pblist %}
  set_img_if_exists( "img-{{pb['game_code']}}", "{{pb['game_code']}}" );
  {% endfor %}
</script>

{% endblock %}
